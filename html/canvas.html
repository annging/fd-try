<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas</title>
</head>
<body style="height: 2000px;">
    <img src="./images/img1.png" alt="">
    <img src="./images/img2.png" alt="">
    <div id="status" style="width: 50%; background-color: aqua;">1111</div>
    <div>1
        <canvas id="drawing" width="200" height="200">A drawing of something.</canvas></div>
    <div>2
        <canvas id="drawing2" width="200" height="200">A drawing of something.</canvas></div>
    <div> 3
        <canvas id="drawing3" width="200" height="200">A drawing of something.</canvas></div>
    <div>4<canvas id="drawing4" width="200" height="200">A drawing of something.</canvas></div>
    <div>5<canvas id="drawing5" width="200" height="200">A drawing of something.</canvas></div>
        <div>6<canvas id="drawing6" width="200" height="200">A drawing of something.</canvas>
    </div>
    <script>
        /**
         *  第一部分 认识 requestAnimationFrame
        **/
        /*let count = 0;
        function updateProgress() {
            count++;
            console.log("update..." + count);
            var div = document.getElementById("status");
            div.style.width = (parseInt(div.style.width, 10) + 5) + "%";
            console.log(div.style.width);
            if (div.style.width != "100%") {
                requestAnimationFrame(updateProgress);
            }
        }
       requestAnimationFrame(updateProgress);*/

       /**
        *  第二部分  通过requestAnimationFrame节流  不超过50毫秒执行一次
        **/ 
        /*function expensiveOperation() {
            console.log('Invoked at', Date.now());
        }
        window.addEventListener('scroll', () => {
            expensiveOperation();
        });

        let enabled = true;
        function expensiveOperation1() {
            console.log('_Invoked at', Date.now());
        }
        window.addEventListener('scroll', () => {
            if (enabled) {
                enabled = false;
                window.requestAnimationFrame(expensiveOperation1);
                window.setTimeout(() => enabled = true, 50);
            }
        });*/
        window.onload = function() {

        let drawing = document.getElementById("drawing");
        if (drawing.getContext) {
            let context = drawing.getContext("2d");

            context.fillStyle = "red";
            context.fillRect(10, 10, 50, 80);

            context.fillStyle = "rgba(0, 0, 255, 0.5";
            context.fillRect(30, 30, 50, 50);

            context.strokeStyle = "#dddddd";
            context.strokeRect(10, 10, 100, 100);
            context.save();

            context.lineWidth = 10;
            context.lineCap = "square";
            context.lineJoin = "miter"; //
            context.strokeStyle = "red";
            context.strokeRect(80, 80, 50, 50);

            context.restore();
            context.fillStyle = "yellow";
            context.fillRect(120, 120, 50, 50);

            context.clearRect(40, 40, 20, 20);

            


            

            let imgURI = drawing.toDataURL("image/png");
            let image = document.createElement("img");
            image.src = imgURI;
            document.body.appendChild(image);
        }

        let drawing2 = document.getElementById("drawing2");
        if (drawing2.getContext) {
            let context = drawing2.getContext("2d");
            context.globalAlpha = 0.5;
            // 设置阴影
            context.shadowOffsetX = 5;
            context.shadowOffsetY = 5;
            context.shadowBlur = 4;
            context.shadowColor = "rgba(0, 0, 0, 0.5)";
            // 绘制红色矩形
            context.fillStyle = "#ff0000";
            context.fillRect(10, 10, 50, 50);
            context.globalAlpha = 1;
            context.globalCompositeOperation = "xor";
            // 绘制蓝色矩形
            context.fillStyle = "rgba(0,0,255,1)";
            context.fillRect(30, 30, 50, 50);
        }

        let drawing3 = document.getElementById("drawing3");
        if (drawing3.getContext) {
            let context = drawing3.getContext("2d");
            let gradient = context.createLinearGradient(30, 30, 70, 70);
            gradient.addColorStop(0, "white");
            gradient.addColorStop(1, "black");

            context.fillStyle = "#ff0000";
            context.fillRect(10, 10, 50, 50);

            context.fillStyle = gradient;
            context.fillRect(30, 30, 50, 50);
        }

        let drawing4 = document.getElementById("drawing4");
        if (drawing4.getContext) {
            let context = drawing4.getContext("2d");
            let gradient = context.createRadialGradient(55, 55, 10, 55, 55, 30);
            gradient.addColorStop(0, "white");
            gradient.addColorStop(1, "black");

            context.fillStyle = "#ff0000";
            context.fillRect(10, 10, 50, 50);

            context.fillStyle = gradient;
            context.fillRect(30, 30, 50, 50);
            
            let imageData = context.getImageData(10, 5, 50, 50);
            console.log(imageData);
        }
        let drawing5 = document.getElementById("drawing5");
        if (drawing5.getContext) {
            let context = drawing5.getContext("2d");
            
            let image = document.images[0];
            let pattern = context.createPattern(image, "repeat");
            context.fillStyle = pattern;
            context.fillRect(10, 10, 150, 150);

        }

       /* let drawing6 = document.getElementById("drawing6");
        if (drawing6.getContext) {
            let context = drawing6.getContext("2d"),
            image = document.images[1],
            imageData, data,
            i, len, average,
            red, green, blue, alpha;
            // 绘制图像
            context.drawImage(image, 0, 0);
            // 取得图像数据
            imageData = context.getImageData(0, 0, image.width, image.height);
            data = imageData.data;
            for (i=0, len=data.length; i < len; i+=4) {
            red = data[i];
            green = data[i+1];
            blue = data[i+2];
            alpha = data[i+3];
            // 取得RGB 平均值
            average = Math.floor((red + green + blue) / 3);
            // 设置颜色，不管透明度
            data[i] = average;
            data[i+1] = average;
            data[i+2] = average;
            }
            // 将修改后的数据写回ImageData 并应用到画布上显示出来
            imageData.data = data;
            context.putImageData(imageData, 0, 0);
            
           

        }*/
    };
    </script>
</body>
</html>